#!/bin/bash

# set up xcalar file
echo "Set up Xcalar Insight..."
# Get rid of abs paths 
lessc stylesheets/less/style.less > stylesheets/css/style.css
lessc stylesheets/less/login.less > stylesheets/css/login.css
sed -i 's@/images/@\.\./\.\./images/@' stylesheets/css/*.css
sed -i 's@/images/@images/@' js/setup/paths.js

echo "// This file is autogenerated by MAC.sh or RUNME.sh" > js/setup/constructorVersion.js
echo -n "var gConstructorVersion = '" >> js/setup/constructorVersion.js
echo -n `md5sum js/setup/constructor.js | cut -d' ' -f4` >> js/setup/constructorVersion.js
echo -n "';" >> js/setup/constructorVersion.js
echo -n "var gGitVersion = '" >> js/setup/constructorVersion.js
echo -n `git log --pretty=oneline --abbrev-commit -1 | cut -d' ' -f1` >> js/setup/constructorVersion.js
echo "';" >> js/setup/constructorVersion.js

if [ -e "../xcalar/src/bin/tests/XcalarApiVersionSignature_types.js" ]
then
    diff -q "../xcalar/src/bin/tests/XcalarApiVersionSignature_types.js" ./js/thrift/XcalarApiVersionSignature_types.js > /dev/null 2>&1
    ret=$?
    if [ "$ret" != "0" ]
    then
        echo "*** WARNING: thrift interfaces may be incompatible"
        echo "XcalarApiVersionSignature_types.js differs"
        echo "If hosting UI from another place, ignore this message"
    fi
    diff -q "../xcalar/src/lib/libapis/XcalarApi.js" ./js/thrift/XcalarApi.js > /dev/null 2>&1
    ret=$?
    if [ "$ret" != "0" ]
    then
        echo "*** WARNING: thrift interfaces may be incompatible"
        echo "XcalarApi.js differs"
        echo "If hosting UI from another place, ignore this message"
    fi
fi
