<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Xcalar Insight</title>
include "partials/loginPart.html"
<script>
$(document).ready(function() {
    // var hasLoginBefore = localStorage.getItem("xc-login");
    // if (hasLoginBefore != null) {
    //     $("#insightVersion").show();
    //     $("#loginContainer").show();
    //     $("#loginNameBox").focus();
    //     $("#swiffycontainer").hide();
    // } else {
        $("#insightVersion").hide();
        $("#loginContainer").hide();
        var stage = new swiffy.Stage(document.getElementById('swiffycontainer'),
                                     swiffyobject, {  });
        stage.start();
        setTimeout(function() {
            $("#swiffycontainer").fadeOut(1000, function() {
                // localStorage.setItem("xc-login", true);
                $("#loginContainer").fadeIn(200);
                $("#loginNameBox").focus();
                $("#insightVersion").fadeIn(200);
            });
        }, 4500);
    // }

  $("#loginForm").submit(function(event) {
        // prevents form from having it's default action
        event.preventDefault();
        var username = $("#loginNameBox").val();
        var fullUsername = username;
        if (username === "") {
            return;
        }

        var index = username.indexOf("/");
        if (index > 0) {
            username = username.substring(0, index);
        }

        console.log("username:", username);
        var pass = $('#loginPasswordBox').val();
        var str = {"xipassword": pass};

        /**
        $.ajax({
            type: 'POST',
            data: JSON.stringify(str),
            contentType: 'application/json',
            url: 'http://104.197.165.32:12123',
            success: function(data) {
                // ret = JSON.stringify(data);
                ret = data;
                if (ret == "Success") {
                    console.log('success');
                    submit();
                } else if (ret == "Fail") {
                    alert('Incorrect Password. Please try again.');
                    console.log('ret == "Fail"', data, ret);
                } else {
                    //Auth server probably down or something. Just let them in
                    console.log('shouldnt be here', data, ret);
                    submit();
                }
            },
            error: function(data) {
                //Auth server probably down or something. Just let them in
                console.error(error);
                submit();
            }
        });*/

        function submit() {
            sessionStorage.setItem("xcalar-username", username);
            sessionStorage.setItem("xcalar-fullUsername", fullUsername);
            // XXX this redirect is only for temporary use
            window.location = paths.indexAbsolute;
        }
        submit();
    });

    $("#signupButton").click(function() {
        $("#loginContainer").addClass("signup");
        $("#login").fadeOut(function() {
            $("#signup").fadeIn();
        });
    });

    $("#signup-login").click(function() {
        $("#loginContainer").removeClass("signup");
        $("#signup").fadeOut(function() {
            $("#login").fadeIn();
        });
    });

    $("#insightVersion").html("Version SHA: " +
        XVM.getSHA().substring(0, 6) + ", Revision " + XVM.getVersion());
});
</script>
<!-- start auto template tags -->
<!-- end auto template tags -->
</body>
</html>
