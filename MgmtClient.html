<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements. See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership. The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License. You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied. See the License for the
  specific language governing permissions and limitations
  under the License.

-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>XcalarApi Javascript Client</title>

  <script src="thrift.js" type="text/javascript"></script>
  <script src="Status_types.js" type="text/javascript"></script>
  <script src="libapis_common_types.js" type="text/javascript"></script>
  <script src="XcalarApiService.js" type="text/javascript"></script>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>


  <script type="text/javascript" charset="utf-8">
  //<![CDATA[
  $(document).ready(function(){
     $('table.XcalarApiService').attr('width', 500);
  });

  function XcalarLoad() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.input = new XcalarApiInputT();
    workItem.input.loadInput = new XcalarApiBulkLoadInputT();
    workItem.input.loadInput.srcTable = new XcalarApiTableT();
    workItem.input.loadInput.dstTable = new XcalarApiTableT();

    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiBulkLoad;
    workItem.input.loadInput.loadFromPath = true;
    workItem.input.loadInput.path = $('#LoadUrl').val();
    workItem.input.loadInput.maxSize = 0;
    workItem.input.loadInput.dfType = DfFormatTypeT.DfTypeJSON;
    workItem.input.loadInput.keyName = $('#LoadKey').val();
    workItem.input.loadInput.srcTable.tableName = "";
    workItem.input.loadInput.srcTable.handle = 0;
    workItem.input.loadInput.dstTable.tableName = $('#LoadTableName').val();
    workItem.input.loadInput.dstTable.handle = 0;

    try {
        result = client.queueWork(workItem);
        $('#LoadStatus').val(result.output.statusOutput);
        $('#LoadStatus').css('color', 'black');
    } catch(ouch) {
        $('#LoadStatus').val('fail');
        $('#LoadStatus').css('color', 'red');
    }
  }

  function XcalarGetCount() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiCountUnique;
    workItem.input = new XcalarApiInputT();
    workItem.input.tableInput = new XcalarApiTableT();
    workItem.input.tableInput.tableName = $('#GetCountTableName').val();
    workItem.input.tableInput.handle = 0;

    try {
        result = client.queueWork(workItem);
        $('#GetCountStatus').val(result.output.countOutput.status);
        $('#GetCountNum').val(result.output.countOutput.numCounts);
        $('#GetCount0').val(result.output.countOutput.counts[0]);

        $('#GetCountStatus').css('color', 'black');
        $('#GetCountNum').css('color', 'black');
        $('#GetCount0').css('color', 'black');
    } catch(ouch) {
      $('#GetCountStatus').val(ouch.status);
      $('#GetCountStatus').css('color', 'red');
    }
  }

  function XcalarListTables() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiListTables;

    try {
        result = client.queueWork(workItem);
        $('#ListTablesCount').val(result.output.listTablesOutput.numTables);
        $('#ListTables0Name').val(result.output.listTablesOutput.tables[0].tableName);

        $('#ListTablesCount').css('color', 'black');
        $('#ListTables0Name').css('color', 'black');
    } catch(ouch) {
      $('#ListTablesCount').val('failure');
      $('#ListTables0Name').val('failure');
      $('#ListTablesCount').css('color', 'red');
      $('#ListTables0Name').css('color', 'red');
    }
  }

  function XcalarGetStats() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.input = new XcalarApiInputT();
    workItem.input.statInput = new XcalarApiGetStatInputT();

    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiGetStat;
    workItem.input.statInput.nodeId = 0;
    workItem.input.statInput.threadNamePattern = $('#GetStatThreadPattern').val();
    workItem.input.statInput.statNamePattern = $('#GetStatNamePattern').val();

    try {
        result = client.queueWork(workItem);
        $('#GetStatStatus').val(result.output.statOutput.status);
        $('#GetStat0Thread').val(result.output.statOutput.stats[0].threadName);
        $('#GetStat0Name').val(result.output.statOutput.stats[0].statName);
        $('#GetStat0Val').val(result.output.statOutput.stats[0].statValue);

        $('#GetStatStatus').css('color', 'black');
        $('#GetStat0Thread').css('color', 'black');
        $('#GetStat0Name').css('color', 'black');
        $('#GetStat0Val').css('color', 'black');
    } catch(ouch) {
        $('#GetStatStatus').val('fail');
        $('#GetStatStatus').css('color', 'red');
    }
  }

  function XcalarShutdown() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiShutdown;

    try {
        result = client.queueWork(workItem);
    } catch(ouch) {
    }
  }

  function XcalarCatTable() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiMakeResultSet;
    workItem.input = new XcalarApiInputT();
    workItem.input.tableInput = new XcalarApiTableT();
    workItem.input.tableInput.tableName = $('#CatTableName').val();
    workItem.input.tableInput.handle = 0;

    try {
        result = client.queueWork(workItem);
    } catch(ouch) {
      $('#CatTableStatus').val('fail');
      $('#CatTableStatus').css('color', 'red');
      return;
    }

    if (result.jobStatus != StatusT.StatusOk) {
      $('#CatTableStatus').val('fail');
      $('#CatTableStatus').css('color', 'red');
      return;
    }

    if (result.output.makeResultSetOutput.status != StatusT.StatusOk) {
      $('#CatTableStatus').val('fail');
      $('#CatTableStatus').css('color', 'red');
      return;
    }
    workItem.api = XcalarApisT.XcalarApiResultSetNext;
    workItem.input = new XcalarApiInputT();
    workItem.input.resultSetNextInput = new XcalarApiResultSetNextInputT();
    workItem.input.resultSetNextInput.resultSet =
        result.output.makeResultSetOutput.resultSet;
    workItem.input.resultSetNextInput.numRecords = 5;
    try {
        result = client.queueWork(workItem);
    } catch(ouch) {
      $('#CatTableStatus').val('fail');
      $('#CatTableStatus').css('color', 'red');
      return;
    }

    if (result.jobStatus != StatusT.StatusOk) {
      $('#CatTableStatus').val('fail');
      $('#CatTableStatus').css('color', 'red');
      return;
    }

    $('#CatTableStatus').val(0);
    $('#CatTableNum').val(result.output.resultSetNextOutput.numRecords);
    $('#CatTableKey0').val(result.output.resultSetNextOutput.records[0].key);
    $('#CatTableVal0').val(result.output.resultSetNextOutput.records[0].value);
    $('#CatTableNum').css('color', 'black');
    $('#CatTableKey0').css('color', 'black');
    $('#CatTableVal0').css('color', 'black');
  }

  function XcalarFilter() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.input = new XcalarApiInputT();
    workItem.input.filterInput = new XcalarApiFilterInputT();
    workItem.input.filterInput.table = new XcalarApiTableT();
    workItem.input.filterInput.filterTable = new XcalarApiTableT();

    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiFilter;
    workItem.input.filterInput.table.tableName = $('#FilterSrcTableName').val();
    workItem.input.filterInput.table.handle = 0;
    workItem.input.filterInput.filterTable.tableName = $('#FilterDstTableName').val();
    workItem.input.filterInput.filterTable.handle = 0;
    workItem.input.filterInput.filterOp = OperatorsOpT.OperatorsLessEqual;
    workItem.input.filterInput.compValue = 3255348558481219398;

    try {
        result = client.queueWork(workItem);
        $('#FilterTableStatus').val(result.output.statusOutput);
        $('#FilterTableStatus').css('color', 'black');
    } catch(ouch) {
        $('#FilterTableStatus').val('fail');
        $('#FilterTableStatus').css('color', 'red');
    }
  }

  function XcalarJoin() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.input = new XcalarApiInputT();
    workItem.input.joinInput = new XcalarApiJoinInputT();
    workItem.input.joinInput.leftTable = new XcalarApiTableT();
    workItem.input.joinInput.rightTable = new XcalarApiTableT();
    workItem.input.joinInput.joinTable = new XcalarApiTableT();

    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiJoin;
    workItem.input.joinInput.leftTable.tableName = $('#JoinLeftTableName').val();
    workItem.input.joinInput.leftTable.handle = 0;
    workItem.input.joinInput.rightTable.tableName = $('#JoinLeftTableName').val();
    workItem.input.joinInput.rightTable.handle = 0;
    workItem.input.joinInput.joinTable.tableName = $('#JoinDstTableName').val();
    workItem.input.joinInput.joinTable.handle = 0;
    workItem.input.joinInput.joinType = OperatorsOpT.OperatorsInnerJoin;

    try {
        result = client.queueWork(workItem);
        $('#JoinStatus').val(result.output.statusOutput);
        $('#JoinStatus').css('color', 'black');
    } catch(ouch) {
        $('#JoinStatus').val('fail');
        $('#JoinStatus').css('color', 'red');
    }
  }

  function XcalarGroupBy() {
    var transport = new Thrift.Transport("http://localhost:9090/thrift/service/XcalarApiService/");
    var protocol  = new Thrift.Protocol(transport);
    var client    = new XcalarApiServiceClient(protocol);

    var workItem = new XcalarApiWorkItemT();
    workItem.input = new XcalarApiInputT();
    workItem.input.groupByInput = new XcalarApiGroupByInputT();
    workItem.input.groupByInput.table = new XcalarApiTableT();
    workItem.input.groupByInput.groupByTable = new XcalarApiTableT();

    workItem.apiVersion = 0;
    workItem.api = XcalarApisT.XcalarApiGroupBy;
    workItem.input.groupByInput.table.tableName = $('#GroupSrcTableName').val();
    workItem.input.groupByInput.table.handle = 0;
    workItem.input.groupByInput.groupByTable.tableName = $('#GroupDstTableName').val();
    workItem.input.groupByInput.groupByTable.handle = 0;
    workItem.input.groupByInput.groupByOp = OperatorsOpT.OperatorsAverage;

    try {
        result = client.queueWork(workItem);
        $('#GroupStatus').val(result.output.statusOutput);
        $('#GroupStatus').css('color', 'black');
    } catch(ouch) {
        $('#GroupStatus').val('fail');
        $('#GroupStatus').css('color', 'red');
    }
  }

  //]]>
  </script>

</head>
<body>

  <h2>XcalarApi Load</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> LoadTableName: </td>
      <td><input type="text" id="LoadTableName" value="tempTable-0"/></td>
    </tr> <tr>
      <td> LoadUrl: </td>
      <td><input type="text" id="LoadUrl" value="file:///var/tmp/yelp/user"/></td>
    </tr> <tr>
      <td> LoadKey: </td>
      <td><input type="text" id="LoadKey" value="user_id"/></td>
    </tr> <tr>
      <td> LoadStatus: </td>
      <td><input type="text" id="LoadStatus" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="load" value="load" onclick="javascript:XcalarLoad();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi Get Count</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> TableName: </td>
      <td><input type="text" id="GetCountTableName" value="tempTable-0"/></td>
    </tr> <tr>
      <td> GetCountStatus: </td>
      <td><input type="text" id="GetCountStatus" value=""/></td>
    </tr> <tr>
      <td> GetCountNum: </td>
      <td><input type="text" id="GetCountNum" value=""/></td>
    </tr> <tr>
      <td> GetCount0: </td>
      <td><input type="text" id="GetCount0" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="getCount" value="getCount" onclick="javascript:XcalarGetCount();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi List Tables</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> ListTablesCount: </td>
      <td><input type="text" id="ListTablesCount" value=""/></td>
    </tr> <tr>
      <td> ListTables0Name: </td>
      <td><input type="text" id="ListTables0Name" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="listTables" value="listTables" onclick="javascript:XcalarListTables();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi Get Stat</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> GetStatThreadPattern: </td>
      <td><input type="text" id="GetStatThreadPattern" value="*"/></td>
    </tr> <tr>
      <td> GetStatNamePattern: </td>
      <td><input type="text" id="GetStatNamePattern" value="*"/></td>
    </tr> <tr>
      <td> GetStatStatus: </td>
      <td><input type="text" id="GetStatStatus" value=""/></td>
    </tr> <tr>
      <td> GetStat0Thread: </td>
      <td><input type="text" id="GetStat0Thread" value=""/></td>
    </tr> <tr>
      <td> GetStat0Name: </td>
      <td><input type="text" id="GetStat0Name" value=""/></td>
    </tr> <tr>
      <td> GetStat0Val: </td>
      <td><input type="text" id="GetStat0Val" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="getStats" value="getStats" onclick="javascript:XcalarGetStats();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi Cat Table</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> CatTableName: </td>
      <td><input type="text" id="CatTableName" value="tempTable-0"/></td>
    </tr> <tr>
      <td> CatTableStatus: </td>
      <td><input type="text" id="CatTableStatus" value=""/></td>
    </tr> <tr>
      <td> CatTableNum: </td>
      <td><input type="text" id="CatTableNum" value=""/></td>
    </tr> <tr>
      <td> CatTableKey0: </td>
      <td><input type="text" id="CatTableKey0" value=""/></td>
    </tr> <tr>
      <td> CatTableVal0: </td>
      <td><input type="text" id="CatTableVal0" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="catTable" value="catTable" onclick="javascript:XcalarCatTable();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi Filter</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> TableName: </td>
      <td><input type="text" id="FilterSrcTableName" value="tempTable-0"/></td>
    </tr> <tr>
      <td> FilterTableName: </td>
      <td><input type="text" id="FilterDstTableName" value="tempTable-1"/></td>
    </tr> <tr>
      <td> FilterTableStatus: </td>
      <td><input type="text" id="FilterTableStatus" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="filter" value="filter" onclick="javascript:XcalarFilter();"/></td>
    </tr>
  </table>
  </form>

  <h2>XcalarApi Join</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> JoinLeftTableName: </td>
      <td><input type="text" id="JoinLeftTableName" value="tempTable-0"/></td>
    </tr> <tr>
      <td> JoinRightTableName: </td>
      <td><input type="text" id="JoinRightTableName" value="tempTable-1"/></td>
    </tr> <tr>
      <td> JoinDstTableName: </td>
      <td><input type="text" id="JoinDstTableName" value="tempTable-2"/></td>
    </tr> <tr>
      <td> JoinStatus: </td>
      <td><input type="text" id="JoinStatus" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="join" value="join" onclick="javascript:XcalarJoin();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi GroupBy</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td> GroupSrcTableName: </td>
      <td><input type="text" id="GroupSrcTableName" value="tempTable-0"/></td>
    </tr> <tr>
    <tr>
      <td> GroupDstTableName: </td>
      <td><input type="text" id="GroupDstTableName" value="tempTable-3"/></td>
    </tr> <tr>
      <td> GroupStatus: </td>
      <td><input type="text" id="GroupStatus" value=""/></td>
    </tr> <tr>
      <td><input type="button" id="groupBy" value="groupBy" onclick="javascript:XcalarGroupBy();"/></td>
    </tr>
  </table>
  </form>
  
  <h2>XcalarApi Shutdown</h2>
  <form action="">
  <table class="XcalarApiService">
    <tr>
      <td><input type="button" id="shutdown" value="shutdown" onclick="javascript:XcalarShutdown();"/></td>
    </tr>
  </table>
  </form>

</body>
</html>
